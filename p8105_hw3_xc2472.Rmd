---
title: "HW 3"
author: "Xing Chen"
date: 2019-10-12
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(p8105.datasets)
```


# Problem 1

## import the dataset instacart

```{r}
data("instacart")

instacart %>% 
  group_by(department) %>% 
  summarize(n = n())

instacart %>% 
  group_by(department) %>% 
  summarize(
    mean_order_hour = mean(order_hour_of_day, na.rm = TRUE)
  )
```

There are `r nrow(instacart)` observations in the instacart dataset. Each row represents a
product from an order. There are 21 types of department in this dataset and the mean order
hour of the day is for each department is around 13. The `aisle` variable represents the 
type of the goods that are ordered and `order_day shows` the day of the week on which the 
order is placed. For example, the first row in the dataset tells us yogurt was ordered on 
Thursday and this product has been ordered by this person in the past. 

## 
```{r}
instacart %>% 
  group_by(aisle) %>% 
  summarize(items = n()) %>% 
  arrange(desc(items))
```

There are `r nrow(instacart %>% group_by(aisle) %>% summarize(items = n()))` aisles

## 

```{r}
instacart %>% 
  group_by(aisle) %>% 
  summarize(items = n()) %>% 
  filter(items > 10000) %>% 
  ggplot(aes(x = items, y = aisle)) + 
  geom_point()
```
(how to make the plot readable?)

## create a table showing the three most popular items

```{r}
instacart %>% 
  group_by(aisle) %>% 
  summarize(items = n()) %>% 
  filter(min_rank(desc(items)) < 4) %>% 
  knitr::kable()
```


## a table showing the mean hour

```{r}
instacart %>% 
  group_by(product_name, order_dow) %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  summarize(
    mean_order_time = mean(order_hour_of_day, na.rm = TRUE)
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_order_time
  ) %>% 
  knitr::kable()
```


# problem 2


## Data import and data cleaning

```{r}
data("brfss_smart2010")

brfss_data = 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(
    topic == "Overall Health", 
    response %in% c("Poor", "Fair", "Good", "Very good", "Excellent")
  ) %>% 
  mutate(
    response = factor(response),
    response = fct_relevel(response, "Poor", "Fair", "Good", "Very good", "Excellent")
  )
```


## states were observed at 7 or more locations in 2002 and 2010

```{r}
brfss_data %>% 
  filter(
    year %in% c(2002, 2010)
  ) %>% 
  group_by(year, locationabbr) %>% 
  summarize(
    unique_location = n_distinct(locationdesc)
  ) %>% 
  filter(unique_location > 6) %>% 
knitr::kable()
```


## create a new dataset and make a "spaghetti" plot

```{r}
brfss_excellent = 
  brfss_data %>% 
  filter(response == "Excellent") %>% 
  group_by(locationabbr, year) %>% 
  mutate(
    data_value_average = mean(data_value, na.rm = TRUE)) %>% 
  select(year, locationabbr, data_value_average) %>% 
  distinct()

brfss_excellent %>% 
  ggplot(aes(x = year, y = data_value_average, color = locationabbr)) +
  geom_line() +
  viridis::scale_color_viridis(
    name = "State", 
    discrete = TRUE
  )
```


## Make a two panel plot

```{r}
brfss_data %>% 
  filter(year %in% c(2006, 2010), locationabbr == "NY") %>% 
  ggplot(aes(x = response, y = data_value)) +
  geom_violin() +
  facet_grid(~year)
```


# Problem 3

## load and clean the data

```{r}
accel_data = 
  read_csv(file = "./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    day_type = ifelse(day %in% c("Saturday", "Sunday"), "weekend", "weekday")
  ) %>% 
  select(week, day_id, day, day_type, everything())
accel_data
```


## 

```{r}
accel_tidy_data = 
  accel_data %>% 
  pivot_longer(
    activity_1:activity_1440,
    names_to = "activity",
    values_to = "score") %>% 
  group_by(day_id) %>% 
  mutate(
    total_activity = sum(score))

accel_tidy_data %>% 
  pivot_wider(
    names_from = "activity",
    values_from = "score"
  ) %>% 
  select(day_id, day, total_activity) %>% 
  knitr::kable()
```


## 

```{r}
accel_tidy_data %>% 
  group_by(week) %>% 
  ggplot(aes(x = day_id, y = score, color = week)) +
  geom_point()
```





